<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ë°©íƒˆì¶œ: ì•ˆì „í•œ ë¬¼ë†€ì´ êµì‹¤</title>
    <style>
        /* CSS ìŠ¤íƒ€ì¼ì€ ì´ì „ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìƒëµí•˜ì§€ ì•Šê³  ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤. */
        body, html { margin: 0; padding: 0; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; background-color: #333; }
        .hidden { display: none !important; }
        .screen-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 200; }
        .content-box { background-color: white; padding: 30px 50px; border-radius: 15px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5); max-width: 500px; }
        #start-form h1 { color: #007bff; margin-top: 0; }
        #start-form input { display: block; width: 250px; padding: 12px; margin: 10px auto; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }
        #start-button { margin-top: 20px; padding: 12px 30px; border: none; background-color: #28a745; color: white; border-radius: 5px; cursor: pointer; font-size: 1.2em; font-weight: bold; transition: background-color 0.2s; }
        #start-button:hover { background-color: #218838; }
        #results-content h2 { color: #dc3545; }
        #results-content p { font-size: 1.1em; line-height: 1.6; }
        #feedback-text { width: 90%; padding: 10px; margin-top: 10px; font-size: 1em; border: 1px solid #ccc; border-radius: 5px; resize: vertical; }
        #results-buttons { margin-top: 20px; }
        #submit-results-button, #play-again-button { padding: 10px 20px; font-size: 1em; border-radius: 5px; border: none; color: white; cursor: pointer; margin: 0 5px; }
        #submit-results-button { background-color: #007bff; }
        #play-again-button { background-color: #6c757d; }
        #submit-results-button:disabled { background-color: #aaa; cursor: not-allowed; }
        #timer-display { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.7); color: white; padding: 10px 20px; border-radius: 10px; font-size: 1.2em; font-weight: bold; z-index: 150; }
        #game-container { position: relative; max-width: 1280px; margin: auto; }
        #room-background { width: 100%; display: block; }
        .clickable-object { position: absolute; cursor: pointer; transition: background-color 0.2s; }
        .clickable-object:hover { background-color: rgba(255, 255, 0, 0.3); }
        #obj-monitor { top: 38%; left: 15%; width: 13%; height: 20%; }
        #obj-speaker { top: 15%; left: 25%; width: 5%; height: 12%; }
        #obj-clock { top: 10%; left: 92%; width: 5%; height: 10%; }
        #obj-pencil-case { top: 72%; left: 60%; width: 14%; height: 10%; }
        #obj-door { top: 25%; left: 89%; width: 11%; height: 60%; }
        #modal-content { background-color: white; padding: 20px 40px; border-radius: 10px; min-width: 300px; max-width: 90%; text-align: center; }
        #modal-title { margin-top: 0; }
        #interactive-content { margin: 20px 0; }
        #modal-close-button { margin-top: 10px; padding: 10px 20px; border: none; background-color: #007bff; color: white; border-radius: 5px; cursor: pointer; }
        .puzzle-input { padding: 10px; font-size: 1.2em; text-align: center; width: 100px; margin-right: 10px; }
        .puzzle-button { padding: 10px 15px; font-size: 1.1em; }
        #memory-game-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .card { width: 80px; height: 80px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 5px; }
        .card-front { background: #4a90e2; font-size: 2em; }
        .card-back { background: #f5a623; color: white; font-size: 2.5em; transform: rotateY(180deg); }
    </style>
</head>
<body>
    <!-- HTML êµ¬ì¡°ëŠ” ì´ì „ê³¼ ë™ì¼ -->
    <div id="start-screen" class="screen-overlay">
        <div id="start-form" class="content-box"><h1>ì•ˆì „í•œ ë¬¼ë†€ì´ ë°©íƒˆì¶œ</h1><input type="text" id="input-grade" placeholder="í•™ë…„"><input type="text" id="input-class" placeholder="ë°˜"><input type="text" id="input-name" placeholder="ì´ë¦„"><button id="start-button">ê²Œì„ ì‹œì‘</button></div>
    </div>
    <div id="timer-display" class="hidden">ì†Œìš” ì‹œê°„: 00:00</div>
    <div id="game-container" class="hidden"><img src="https://i.ibb.co/fVCPV3jd/Whisk-8ad83bd02f.jpg" alt="êµì‹¤ ë°°ê²½" id="room-background"><div class="clickable-object" id="obj-monitor" title="ëª¨ë‹ˆí„°"></div><div class="clickable-object" id="obj-speaker" title="ìŠ¤í”¼ì»¤"></div><div class="clickable-object" id="obj-clock" title="ì‹œê³„"></div><div class="clickable-object" id="obj-pencil-case" title="í•„í†µ"></div><div class="clickable-object" id="obj-door" title="êµì‹¤ ë¬¸"></div></div>
    <div id="modal" class="screen-overlay hidden"><div id="modal-content" class="content-box"><h3 id="modal-title"></h3><p id="modal-text"></p><div id="interactive-content"></div><button id="modal-close-button">ë‹«ê¸°</button></div></div>
    <div id="results-screen" class="screen-overlay hidden"><div id="results-content" class="content-box"><h2>ğŸ‰ íƒˆì¶œ ì„±ê³µ! ğŸ‰</h2><p>ì°¸ê°€ì: <strong id="result-grade"></strong>í•™ë…„ <strong id="result-class"></strong>ë°˜ <strong id="result-name"></strong></p><p>ì†Œìš” ì‹œê°„: <strong id="result-time"></strong></p><textarea id="feedback-text" rows="4" placeholder="ê²Œì„ì— ëŒ€í•œ ì†Œê°ì„ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”..."></textarea><div id="results-buttons"><button id="submit-results-button">ì œì¶œí•˜ê¸°</button><button id="play-again-button">ë‹¤ì‹œí•˜ê¸°</button></div></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ==========================================================
        // ì—¬ê¸°ì— 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ ì›¹ ì•± URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        // ==========================================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzpWuzHEcJvfmqlZsNCViUaFazS_cBN6V1wH826l3Z8MNlH1jpcuzJ0r1SkQ9rx35Ps/exec';
        // ==========================================================


        // --- ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ---
        let userGrade, userClass, userName, finalTime;
        let startTime, timerInterval;
        const gameState = { passwordPart1: null, passwordPart2: null, isMemoryGameSolved: false };

        // --- HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const startScreen = document.getElementById('start-screen');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer-display');
        const modal = document.getElementById('modal');
        const resultsScreen = document.getElementById('results-screen');
        
        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        document.getElementById('start-button').addEventListener('click', startGame);
        document.getElementById('obj-monitor').addEventListener('click', handleMonitor);
        document.getElementById('obj-speaker').addEventListener('click', handleSpeaker);
        document.getElementById('obj-clock').addEventListener('click', handleClock);
        document.getElementById('obj-pencil-case').addEventListener('click', handlePencilCase);
        document.getElementById('obj-door').addEventListener('click', handleDoor);
        document.getElementById('modal-close-button').addEventListener('click', closeModal);
        document.getElementById('submit-results-button').addEventListener('click', submitResults);
        document.getElementById('play-again-button').addEventListener('click', () => location.reload());

        function startGame() {
            userGrade = document.getElementById('input-grade').value.trim();
            userClass = document.getElementById('input-class').value.trim();
            userName = document.getElementById('input-name').value.trim();
            if (!userGrade || !userClass || !userName) { alert('í•™ë…„, ë°˜, ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
            startScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            timerDisplay.classList.remove('hidden');
            startTimer();
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const totalSeconds = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            timerDisplay.textContent = `ì†Œìš” ì‹œê°„: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function handleEscapeSuccess() {
            clearInterval(timerInterval);
            finalTime = timerDisplay.textContent.replace('ì†Œìš” ì‹œê°„: ', '');
            gameContainer.classList.add('hidden');
            timerDisplay.classList.add('hidden');
            document.getElementById('result-grade').textContent = userGrade;
            document.getElementById('result-class').textContent = userClass;
            document.getElementById('result-name').textContent = userName;
            document.getElementById('result-time').textContent = finalTime;
            resultsScreen.classList.remove('hidden');
        }
        
        // ================== ë°ì´í„° ì œì¶œ í•¨ìˆ˜ (ìˆ˜ì •ë¨) ==================
        function submitResults() {
            const feedback = document.getElementById('feedback-text').value;
            const submitButton = document.getElementById('submit-results-button');

            if (SCRIPT_URL === 'ì—¬ê¸°ì—_ë³µì‚¬í•œ_URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”') {
                alert('ìŠ¤í¬ë¦½íŠ¸ URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                return;
            }

            // ì œì¶œ ì¤‘ë³µ ë°©ì§€
            submitButton.disabled = true;
            submitButton.textContent = 'ì œì¶œ ì¤‘...';

            const resultData = {
                grade: userGrade,
                class: userClass,
                name: userName,
                time: finalTime,
                feedback: feedback
            };

            // fetch APIë¥¼ ì‚¬ìš©í•˜ì—¬ Apps Scriptë¡œ ë°ì´í„° ì „ì†¡
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(resultData),
            })
            .then(response => response.json())
            .then(data => {
                if (data.result === 'success') {
                    alert('ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤! ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    submitButton.textContent = 'ì œì¶œ ì™„ë£Œ';
                } else {
                    throw new Error(data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert(`ë°ì´í„° ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.\nì˜¤ë¥˜: ${error.message}`);
                submitButton.disabled = false; // ì‹¤íŒ¨ ì‹œ ë‹¤ì‹œ ì‹œë„í•  ìˆ˜ ìˆë„ë¡ ë²„íŠ¼ í™œì„±í™”
                submitButton.textContent = 'ì œì¶œí•˜ê¸°';
            });
        }
        // =============================================================

        function handleDoor() {
            if (!gameState.passwordPart1 || !gameState.passwordPart2) {
                showModal('ì ê¸´ ë¬¸', 'ì•„ì§ ëª¨ë“  ë‹¨ì„œë¥¼ ì°¾ì§€ ëª»í–ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ë‚´ì•¼ í•œë‹¤.');
                return;
            }
            showModal('íƒˆì¶œ ì‹œë„', 'ë„¤ ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            const input = document.createElement('input');
            input.type = 'text'; input.className = 'puzzle-input'; input.maxLength = 4;
            input.placeholder = gameState.passwordPart1 + gameState.passwordPart2;
            const button = document.createElement('button');
            button.textContent = 'íƒˆì¶œ'; button.className = 'puzzle-button';
            button.onclick = () => {
                if (input.value === '2025') {
                    closeModal();
                    handleEscapeSuccess();
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                }
            };
            const interactiveContent = document.getElementById('interactive-content');
            interactiveContent.innerHTML = ''; interactiveContent.appendChild(input); interactiveContent.appendChild(button);
            input.focus();
        }
        
        // --- ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ì´ì „ê³¼ ë™ì¼ (ìˆ˜ì • ë¶ˆí•„ìš”) ---
        function handleSpeaker() { showModal('ìŠ¤í”¼ì»¤', "ìŠ¤í”¼ì»¤ì—ì„œ ì‘ì€ ì•ˆë‚´ ìŒì„±ì´ ë“¤ë¦°ë‹¤. 'ê°€ì¥ í° í™”ë©´ì— ì²« ë²ˆì§¸ ë‹¨ì„œê°€ ìˆìŠµë‹ˆë‹¤.'"); }
        function handleMonitor() {
            if (gameState.isMemoryGameSolved) { showModal('ëª¨ë‹ˆí„°', "ì´ë¯¸ ë©”ëª¨ë¦¬ ê²Œì„ì„ ì™„ë£Œí–ˆë‹¤! ì–»ì€ ë‹¨ì„œëŠ” 'ë¬¼ì˜ ê¹Šì´'ì™€ ê´€ë ¨ ìˆì—ˆë‹¤."); return; }
            showModal('ë©”ëª¨ë¦¬ ê²Œì„', 'ë¬¼ë†€ì´ ì•ˆì „ ìˆ˜ì¹™ê³¼ ê´€ë ¨ëœ ì¹´ë“œë¥¼ ë§ì¶°ë³´ì„¸ìš”.');
            startMemoryGame();
        }
        function handleClock() {
            if (gameState.passwordPart1) { showModal('ì‹œê³„', "ë¬¸ì œë¥¼ ì´ë¯¸ í’€ì—ˆë‹¤. ì–»ì€ ë‹¨ì„œëŠ” '20'ì´ì—ˆë‹¤."); return; }
            showModal('ì‹œê³„ ë¬¸ì œ', "ë¬¼ë†€ì´ëŠ” ë§¤ì‹œ ì •ê°ë¶€í„° 50ë¶„ê°„ í•˜ê³  10ë¶„ê°„ íœ´ì‹í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤. ì˜¤í›„ 1ì‹œì— ë¬¼ë†€ì´ë¥¼ ì‹œì‘í–ˆë‹¤ë©´, ë‘ ë²ˆì§¸ íœ´ì‹ ì‹œê°„ì€ ì˜¤í›„ 2ì‹œ 'ëª‡ ë¶„'ë¶€í„° ì‹œì‘ë ê¹Œìš”?");
            const input = document.createElement('input'); input.type = 'number'; input.className = 'puzzle-input';
            const button = document.createElement('button'); button.textContent = 'í™•ì¸'; button.className = 'puzzle-button';
            button.onclick = () => {
                if (input.value === '50') { alert("ì •ë‹µ! ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë‘ ìë¦¬ '20'ì„ íšë“í–ˆìŠµë‹ˆë‹¤. (íŒíŠ¸: 50 - 30)"); gameState.passwordPart1 = '20'; closeModal(); } else { alert("í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”."); }
            };
            const interactiveContent = document.getElementById('interactive-content');
            interactiveContent.innerHTML = ''; interactiveContent.appendChild(input); interactiveContent.appendChild(button); input.focus();
        }
        function handlePencilCase() {
            if (gameState.passwordPart2) { showModal('í•„í†µ', "ë¬¸ì œë¥¼ ì´ë¯¸ í’€ì—ˆë‹¤. ì–»ì€ ë‹¨ì„œëŠ” '25'ì˜€ë‹¤."); return; }
            showModal('í•„í†µ ë¬¸ì œ', "ë¬¼ë†€ì´ ì „ ì¤€ë¹„ìš´ë™ì€ ìµœì†Œ 5ë¶„ ì´ìƒ, ë¬¼ì— ë“¤ì–´ê°€ê¸° ì „ ì‹¬ì¥ì—ì„œ ë¨¼ ê³³(ë‹¤ë¦¬, íŒ”, ì–¼êµ´, ê°€ìŠ´) ìˆœì„œë¡œ ë¬¼ì„ ì ì…”ì•¼ í•©ë‹ˆë‹¤. ì´ ë‘ ìˆ«ìë¥¼ ê³±í•˜ë©´ ì–¼ë§ˆì¼ê¹Œìš”?");
            const input = document.createElement('input'); input.type = 'number'; input.className = 'puzzle-input';
            const button = document.createElement('button'); button.textContent = 'í™•ì¸'; button.className = 'puzzle-button';
            button.onclick = () => {
                if (input.value === '25') { alert("ì •ë‹µ! ë¹„ë°€ë²ˆí˜¸ì˜ ë§ˆì§€ë§‰ ë‘ ìë¦¬ '25'ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤."); gameState.passwordPart2 = '25'; closeModal(); } else { alert("í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ê³„ì‚°í•´ë³´ì„¸ìš”."); }
            };
            const interactiveContent = document.getElementById('interactive-content');
            interactiveContent.innerHTML = ''; interactiveContent.appendChild(input); interactiveContent.appendChild(button); input.focus();
        }
        function showModal(title, text) {
            document.getElementById('modal-title').textContent = title; document.getElementById('modal-text').textContent = text;
            document.getElementById('interactive-content').innerHTML = ''; modal.classList.remove('hidden');
        }
        function closeModal() { modal.classList.add('hidden'); }
        function startMemoryGame() {
            const board = document.createElement('div'); board.id = 'memory-game-board';
            document.getElementById('interactive-content').appendChild(board);
            const items = ['ğŸŠ', 'ğŸŒ', 'íŠœë¸Œ', 'ğŸ¦º', 'ğŸŠ', 'ğŸŒ', 'íŠœë¸Œ', 'ğŸ¦º'];
            items.sort(() => 0.5 - Math.random()); let flippedCards = []; let matchedPairs = 0;
            items.forEach(item => {
                const card = document.createElement('div'); card.className = 'card'; card.dataset.item = item;
                card.innerHTML = `<div class="card-inner"><div class="card-front">?</div><div class="card-back">${item}</div></div>`;
                card.addEventListener('click', () => { if (flippedCards.length < 2 && !card.classList.contains('flipped')) { card.classList.add('flipped'); flippedCards.push(card); if (flippedCards.length === 2) setTimeout(checkMatch, 1000); } });
                board.appendChild(card);
            });
            function checkMatch() {
                const [card1, card2] = flippedCards;
                if (card1.dataset.item === card2.dataset.item) {
                    matchedPairs++;
                    if (matchedPairs === items.length / 2) { setTimeout(() => { alert("ì„±ê³µ! ì¤‘ìš”í•œ ì •ë³´ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤: 'ê¹Šì€ ë¬¼ì— ë“¤ì–´ê°ˆ ë•ŒëŠ” ë°˜ë“œì‹œ ì–´ë¥¸ê³¼ í•¨ê»˜ ê°€ì„¸ìš”!'"); gameState.isMemoryGameSolved = true; closeModal(); }, 300); }
                } else { card1.classList.remove('flipped'); card2.classList.remove('flipped'); }
                flippedCards = [];
            }
        }
    });
    </script>
</body>
</html>